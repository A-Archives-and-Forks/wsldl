#
#
#Author yuk7(yukx00@gmail.com)
#
#Make rootfs tarball for Alpine Linux on WSL
#THIS IS NOT SHELL SCRIPT

#Download Alpine Linux MINI ROOT fs and glibc package
wget http://dl-cdn.alpinelinux.org/alpine/v3.6/releases/x86_64/alpine-minirootfs-3.6.2-x86_64.tar.gz -O alpine-minirootfs-3.6.2-x86_64.tar.gz
wget https://github.com/sgerrand/alpine-pkg-glibc/releases/download/2.26-r0/glibc-2.26-r0.apk -O glibc-2.26-r0.apk

#Make alpine directory and extract fs
mkdir alpine && cd alpine
tar -zxvf ../alpine-minirootfs-3.6.2-x86_64.tar.gz

#Resolv.conf for WSL
echo "# This file was automatically generated by WSL. To stop automatic generation of this file, remove this line." >./etc/resolv.conf

#copy glibc package
cp ../glibc-*.apk ./root/


#chroot
chroot . /bin/ash

  #Install glibc package
  apk add /root/glibc-2.26-r0.apk --allow-untrusted
  
  #exit chroot
  exit

#remove unneccesary files
rm -rf ./root/*
rm -rf ./root/.ash_history

#pack rootfs.tar.gz
tar -zcvf ../rootfs.tar.gz *

